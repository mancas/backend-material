{% extends "BackendBundle:Layouts:2columns.html.twig" %}

{% block title_section %}
    {{ "Resumen" | trans }}
{% endblock %}

{% block sidenav %}
    {% include 'BackendBundle:Commons:sidenav.html.twig' %}
{% endblock %}

{% block content %}
    <div class="row charts">
        <!-- Small chart -->
        <div class="col-md-3">
            <div class="chart-sm-item chart-green">
                <div class="clearfix">
                    <div class="chart-bars">
                        <canvas id="test-chart"></canvas>
                    </div>
                    <div class="chart-desc">
                        <span>Items sold</span>
                        <h2>1234</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="chart-sm-item chart-red">
                <div class="clearfix">
                    <div class="chart-bars">
                        <canvas id="test-chart-2"></canvas>
                    </div>
                    <div class="chart-desc">
                        <span>Posts</span>
                        <h2>34</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="chart-sm-item chart-deep-purple">
                <div class="clearfix">
                    <div class="chart-bars">
                        <canvas id="test-chart-3"></canvas>
                    </div>
                    <div class="chart-desc">
                        <span>CPC</span>
                        <h2>7379,323</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="chart-sm-item chart-purple">
                <div class="clearfix">
                    <div class="chart-bars">
                        <canvas id="test-chart-4"></canvas>
                    </div>
                    <div class="chart-desc">
                        <span>Visits</span>
                        <h2>48271</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <div class="chart-large-item chart-amber">
                <div class="clearfix">
                    <div class="pie-chart">
                        <canvas id="test-chart-5" data-maxvalue="100" data-value="45"></canvas>
                        <h2></h2>
                    </div>
                    <div class="chart-desc">
                        <span>Emails sent</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="chart-large-item chart-green">
                <div class="clearfix">
                    <div class="pie-chart">
                        <canvas id="test-chart-6" data-maxvalue="100" data-value="68"></canvas>
                        <h2></h2>
                    </div>
                    <div class="chart-desc">
                        <span>Emails sent</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="chart-large-item chart-purple">
                <div class="clearfix">
                    <div class="pie-chart">
                        <canvas id="test-chart-7" data-maxvalue="100" data-value="10"></canvas>
                        <h2></h2>
                    </div>
                    <div class="chart-desc">
                        <span>Emails sent</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="chart-large-item chart-red">
                <div class="clearfix">
                    <div class="pie-chart">
                        <canvas id="test-chart-8" data-maxvalue="100" data-value="89"></canvas>
                        <h2></h2>
                    </div>
                    <div class="chart-desc">
                        <span>Emails sent</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card-item">
                <div class="card-title">
                    <h2>Recent Items</h2>
                    <h3>Since your last visit</h3>
                    <a class="float-action-button fab-red">
                        <i class="fa fa-plus"></i>
                    </a>
                </div>
                <div class="card-description">
                    <div class="list-view">
                        <a class="list-item">
                            <img class="li-small pull-left" src="{{ asset('bundles/backend/img/user.png') }}" />
                            <span class="list-content">
                                <b class="li-title">Picos El Cartujano</b>
                                <small class="li-description">Picos de pan con aceite de oliva</small>
                            </span>
                        </a>

                        <a class="list-item">
                            <img class="li-small pull-left" src="{{ asset('bundles/backend/img/user.png') }}" />
                            <span class="list-content">
                                <b class="li-title">Picos El Cartujano</b>
                                <small class="li-description">Picos de pan con aceite de oliva</small>
                            </span>
                        </a>

                        <a class="list-item">
                            <img class="li-small pull-left" src="{{ asset('bundles/backend/img/user.png') }}" />
                            <span class="list-content">
                                <b class="li-title">Picos El Cartujano</b>
                                <small class="li-description">Picos de pan con aceite de oliva</small>
                            </span>
                        </a>
                    </div>
                </div>

                <div class="card-footer">
                    <a href="#">View all entries</a>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card-item card-lime">
                <div class="card-title">
                    <h2>Recent Items</h2>
                    <h3>Since your last visit</h3>
                    <a class="float-action-button fab-green">
                        <i class="fa fa-plus"></i>
                    </a>
                </div>
                <div class="card-description">
                    <div class="list-view">
                        <a class="list-item">
                            <img class="li-small pull-left" src="{{ asset('bundles/backend/img/user.png') }}" />
                            <span class="list-content">
                                <b class="li-title">Picos El Cartujano</b>
                                <small class="li-description">Picos de pan con aceite de oliva</small>
                            </span>
                        </a>

                        <a class="list-item">
                            <img class="li-small pull-left" src="{{ asset('bundles/backend/img/user.png') }}" />
                            <span class="list-content">
                                <b class="li-title">Picos El Cartujano</b>
                                <small class="li-description">Picos de pan con aceite de oliva</small>
                            </span>
                        </a>

                        <a class="list-item">
                            <img class="li-small pull-left" src="{{ asset('bundles/backend/img/user.png') }}" />
                            <span class="list-content">
                                <b class="li-title">Picos El Cartujano</b>
                                <small class="li-description">Picos de pan con aceite de oliva</small>
                            </span>
                        </a>
                    </div>
                </div>

                <div class="card-footer">
                    <a href="#">View all entries</a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="simple-card sc-cyan">
                <a href="" title="Close" class="close"><i class="fa fa-times"></i></a>
                <p>
                    Cras leo sem, egestas a accumsan eget, euismod at nunc. Praesent vel mi blandit, tempus ex gravida, accumsan dui. Sed sed aliquam augue. Nullam vel suscipit purus, eu facilisis ante. Mauris nec commodo felis. Cras leo sem, egestas a accumsan eget, euismod at nunc. Praesent vel mi blandit, tempus ex gravida, accumsan dui. Sed sed aliquam augue. Nullam vel suscipit purus, eu facilisis ante. Mauris nec commodo felis.
                </p>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {#<script src="{{ asset('bundles/backend/js/excanvas.min.js') }}"></script>
    <script src="{{ asset('bundles/backend/js/jquery.flot.min.js') }}"></script>
    <script src="{{ asset('bundles/backend/js/jquery.flot.resize.min.js') }}"></script>
    <script src="{{ asset('bundles/backend/js/jquery.flot.canvas.js') }}"></script>
    <script src="{{ asset('bundles/backend/js/jquery.flot.time.min.js') }}"></script>#}

    <script>
        Array.prototype.max = function() {
            return Math.max.apply(null, this);
        };

        Array.prototype.min = function() {
            return Math.min.apply(null, this);
        };

        var Charts = {
            hSpace: 4,
            offsetX: 5,
            offsetY: 0,
            radiusOffset: 40,
            tooltips: [],
            bars: function c_bars(id, values, height, width, color) {
                var canvas = document.querySelector('#' + id);
                if (typeof canvas === 'undefined') {
                    console.error('Canvas element does not exist');
                    return;
                }

                var clientRect = canvas.getBoundingClientRect();
                canvas.width = clientRect.width;
                canvas.height = clientRect.height;
                var cWidth = (width ? width : canvas.width);
                var cHeight = (height ? height : canvas.height);
                var yScale = cHeight/values.max();
                var ctx = canvas.getContext('2d');
                var barWidth = cWidth/values.length - this.hSpace;
                var xScalar = cWidth/values.length;

                ctx.fillStyle = color ? color : '#ffffff';
                var points = [];
                for (var i = 0; i < values.length; i++) {
                    ctx.fillRect(1+ i * xScalar,
                            cHeight - values[i] * yScale, barWidth,
                            values[i] * yScale);
                    points.push({x: 1 + i * xScalar, x2: 1 + i * xScalar + barWidth, value: values[i]});
                }

                canvas.addEventListener('mousemove', function (evt) {
                    var mouse = this.getMousePos(canvas, evt);
                    for (var i = 0; i < points.length; i++) {
                        if (mouse.x < points[i].x || mouse.x > points[i].x2) {
                            continue;
                        } else {
                            this.createTooltipIfNeeded(canvas, points[i].value, mouse);
                            return;
                        }
                    }
                }.bind(this));

                canvas.addEventListener('mouseout', function (evt) {
                    this.destroyTooltip(canvas);
                }.bind(this));
            },

            getMousePos: function c_getMousePos(canvas, evt) {
                var rect = canvas.getBoundingClientRect();
                return {
                    x: evt.clientX - rect.left,
                    y: evt.clientY - rect.top
                };
            },

            createTooltipIfNeeded: function c_createTooltipIfNeeded(canvas, value, mouse) {
                var span;
                if (this.tooltips[canvas.id]) {
                    span = this.tooltips[canvas.id];
                } else {
                    span = document.createElement('span');
                    span.classList.add('chart-tooltip');
                    span.style.position = 'absolute';
                    canvas.parentNode.appendChild(span);
                    this.tooltips[canvas.id] = span;
                }

                span.textContent = value;
                span.style.top = (mouse.y - (span.clientHeight/2) - this.offsetY) + 'px';
                span.style.left = (mouse.x + span.clientWidth + this.offsetX) + 'px';
            },

            destroyTooltip: function c_destroyTootltip(canvas) {
                var span = this.tooltips[canvas.id];
                delete this.tooltips[canvas.id];
                span.parentNode.removeChild(span);
            },

            pie: function c_pie(id, maxValue, currentValue, color) {
                var canvas = document.querySelector('#' + id);
                var maxValue = maxValue || parseInt(canvas.dataset.maxvalue);
                var currentValue = currentValue || parseInt(canvas.dataset.value);

                if (parseInt(currentValue) > parseInt(maxValue)) {
                    console.error('Wrong values detected');
                    return;
                }

                if (typeof canvas === 'undefined') {
                    console.error('Canvas element does not exist');
                    return;
                }

                var h2 = canvas.nextElementSibling;
                if (typeof h2 !== 'undefined') {
                    h2.textContent = (100*currentValue)/maxValue + '%';
                }

                var startAngle = -0.5 * Math.PI;
                var endAngle = (((2 * Math.PI) * currentValue) / maxValue) - 0.5 * Math.PI;
                var clientRect = canvas.getBoundingClientRect();

                canvas.width = clientRect.width;
                canvas.height = clientRect.width;
                var radius = (canvas.width / 2) - this.radiusOffset;
                var ctx = canvas.getContext('2d');
                ctx.strokeStyle = color ? color : '#ffffff';
                ctx.lineWidth = 8;
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.beginPath();
                ctx.arc(0, 0, radius, startAngle, endAngle);
                ctx.stroke();

                // Draw the rest of the circle
                ctx.beginPath();
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.arc(0, 0, radius, endAngle, startAngle);
                ctx.stroke();

                this._drawTicks(ctx, radius);
            },

            _drawTicks: function c_drawTicks(ctx, radius) {
                var rot = 0;
                ctx.lineWidth = 1;
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                while (rot < 2*Math.PI) {
                    ctx.beginPath();
                    ctx.moveTo(radius + 10, 0);
                    ctx.lineTo(radius + 18, 0);
                    ctx.stroke();

                    ctx.rotate(Math.PI/8);

                    ctx.beginPath();
                    ctx.moveTo(radius + 10, 0);
                    ctx.lineTo(radius + 14, 0);
                    ctx.stroke();

                    rot += Math.PI/4;
                    ctx.rotate(Math.PI/8);
                }
            }
        };

        Charts.bars('test-chart', [20, 3, 2, 1, 9, 4, 1, 2, 8, 7], null, null, '#ffffff');
        Charts.bars('test-chart-2', [9, 4,9, 3, 2, 1, 1, 2, 8, 7], null, null, '#ffffff');
        Charts.bars('test-chart-3', [9, 3, 2, 8, 7,9, 3, 2, 1], null, null, '#ffffff');
        Charts.bars('test-chart-4', [9, 3, 2, 1, 9,9, 3, 2, 1, 8, 7], null, null, '#ffffff');
        Charts.pie('test-chart-5');
        Charts.pie('test-chart-6');
        Charts.pie('test-chart-7');
        Charts.pie('test-chart-8');
    </script>
{% endblock %}